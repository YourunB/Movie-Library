<main>
  <section *ngIf="movie$ | async as movie; else loading" class="movie-hero"
    [style.--backdrop]="movie.backdrop_path ? 'url(' + ('https://image.tmdb.org/t/p/w1280' + movie.backdrop_path) + ')' : 'none'">
    <div class="hero-overlay"></div>
    <div class="hero-content">
      <img class="poster"
        [src]="movie.poster_path ? ('https://image.tmdb.org/t/p/w500' + movie.poster_path) : 'images/placeholder.jpg'"
        [alt]="movie.title"
        loading="lazy" />
      <div class="details">
        <h1 class="title">{{ movie.title }}</h1>
        <div class="meta">
          <span class="label">Release:</span>
          <span>{{ movie.release_date }}</span>
        </div>
        <p class="overview">{{ movie.overview }}</p>
        @if(isAuth$ | async) {
        <mat-icon [ngClass]="{ 'in-watchlist': watchListService.isMovieInWatchlist(movie.id) | async }"
          class="favorite-icon" (click)="toggleFavorite($event, movie)">favorite</mat-icon>
        }
      </div>
    </div>
  </section>

  <section class="trailer-block">
    <h2>Trailer</h2>
    <div class="video-aspect">
      <iframe *ngIf="trailerUrl$ | async as trailerUrl" [src]="trailerUrl" frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        allowfullscreen title="Trailer for {{ (movie$ | async)?.title }}">
      </iframe>
      <p *ngIf="(trailerUrl$ | async) === null">Trailer not available.</p>
    </div>
  </section>

  <section class="cast-section">
    <h2>Cast</h2>
    <div *ngIf="cast$ | async as cast">
      <div *ngIf="cast.length === 0" class="empty-state">No cast information available.</div>
      <div class="cast-grid" *ngIf="cast.length > 0">
        <div class="cast-card" *ngFor="let c of cast">
          <img [src]="c.profile_path ? ('https://image.tmdb.org/t/p/w185' + c.profile_path) : 'images/placeholder.jpg'"
            [alt]="c.name"
            loading="lazy" />
          <div class="cast-meta">
            <div class="name">{{ c.name }}</div>
            <div class="character" *ngIf="c.character">as {{ c.character }}</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <ng-template #loading>
    <section class="movie-hero skeleton">
      <div class="hero-overlay"></div>
      <div class="hero-content">
        <div class="poster skeleton-box"></div>
        <div class="details">
          <h1 class="title skeleton-text">Loading title...</h1>
          <div class="meta">
            <span class="label skeleton-text short"></span>
            <span class="skeleton-text short"></span>
          </div>
          <p class="overview skeleton-text long"></p>
        </div>
      </div>
    </section>
  </ng-template>
</main>
